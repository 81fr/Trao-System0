<!DOCTYPE html>
<html lang="ar" dir="rtl">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0" />
    <title>Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± ÙˆØ§Ù„ØªØ­Ù„ÙŠÙ„Ø§Øª - ØªØ±Ø§ÙˆÙ</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="assets/vendor/fontawesome/css/all-svg.css">
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;500;700;800&display=swap"
        rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <style>
        .rpt-hero {
            background: linear-gradient(135deg, #3E4559 0%, #00A59B 55%, #8CC240 100%);
            border-radius: 16px;
            padding: 28px 32px;
            color: white;
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 22px;
            position: relative;
            overflow: hidden;
        }

        .rpt-hero::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -8%;
            width: 220px;
            height: 220px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 50%;
        }

        .rpt-hero h2 {
            font-size: 1.35rem;
            font-weight: 700;
            margin: 0 0 4px;
            z-index: 1;
        }

        .rpt-hero p {
            margin: 0;
            opacity: .8;
            font-size: .88rem;
            z-index: 1;
        }

        .hero-stats {
            display: flex;
            gap: 24px;
            z-index: 1;
        }

        .h-stat {
            text-align: center;
        }

        .h-stat .h-val {
            font-size: 1.5rem;
            font-weight: 800;
            display: block;
        }

        .h-stat .h-lbl {
            font-size: .72rem;
            opacity: .8;
        }

        .filter-bar {
            background: white;
            border-radius: 14px;
            padding: 16px 20px;
            box-shadow: 0 4px 16px rgba(0, 0, 0, .04);
            display: flex;
            gap: 12px;
            align-items: flex-end;
            flex-wrap: wrap;
            margin-bottom: 22px;
        }

        .fg {
            display: flex;
            flex-direction: column;
            gap: 3px;
        }

        .fg label {
            font-size: .72rem;
            color: #8c97a8;
            font-weight: 500;
        }

        .fg input,
        .fg select {
            border: 1.5px solid #e6ecf2;
            border-radius: 10px;
            padding: 8px 12px;
            font-family: 'Tajawal', sans-serif;
            font-size: .84rem;
            color: #3E4559;
            outline: none;
            transition: border-color .2s;
        }

        .fg input:focus,
        .fg select:focus {
            border-color: #00A59B;
        }

        .btn-f {
            padding: 8px 16px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-family: 'Tajawal', sans-serif;
            font-size: .82rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 5px;
            transition: all .2s;
        }

        .btn-main {
            background: linear-gradient(135deg, #00A59B, #8CC240);
            color: white;
        }

        .btn-main:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 165, 155, .3);
        }

        .btn-out {
            background: white;
            color: #3E4559;
            border: 1.5px solid #e6ecf2 !important;
        }

        .btn-out:hover {
            border-color: #00A59B !important;
            color: #00A59B;
        }

        .sum-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(165px, 1fr));
            gap: 12px;
            margin-bottom: 22px;
        }

        .sc {
            background: white;
            border-radius: 13px;
            padding: 16px;
            box-shadow: 0 4px 14px rgba(0, 0, 0, .04);
            display: flex;
            align-items: center;
            gap: 12px;
            border-right: 4px solid transparent;
            transition: transform .2s;
        }

        .sc:hover {
            transform: translateY(-2px);
        }

        .sc.b1 {
            border-right-color: #00A59B
        }

        .sc.b2 {
            border-right-color: #8CC240
        }

        .sc.b3 {
            border-right-color: #f59e0b
        }

        .sc.b4 {
            border-right-color: #8b5cf6
        }

        .sc.b5 {
            border-right-color: #ef4444
        }

        .sc.b6 {
            border-right-color: #06b6d4
        }

        .si {
            width: 42px;
            height: 42px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1rem;
            flex-shrink: 0;
            color: white;
        }

        .si.c1 {
            background: linear-gradient(135deg, #00A59B, #008f87)
        }

        .si.c2 {
            background: linear-gradient(135deg, #8CC240, #6fa830)
        }

        .si.c3 {
            background: linear-gradient(135deg, #f59e0b, #d97706)
        }

        .si.c4 {
            background: linear-gradient(135deg, #8b5cf6, #7c3aed)
        }

        .si.c5 {
            background: linear-gradient(135deg, #ef4444, #dc2626)
        }

        .si.c6 {
            background: linear-gradient(135deg, #06b6d4, #0891b2)
        }

        .si-info h4 {
            margin: 0;
            font-size: .7rem;
            color: #8c97a8;
            font-weight: 400;
        }

        .si-info .sv {
            font-size: 1.25rem;
            font-weight: 800;
            color: #3E4559;
        }

        .g2 {
            display: grid;
            grid-template-columns: 1.5fr 1fr;
            gap: 16px;
            margin-bottom: 20px;
        }

        .g3 {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 16px;
            margin-bottom: 20px;
        }

        .g22 {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
            margin-bottom: 20px;
        }

        .cb {
            background: white;
            border-radius: 14px;
            padding: 18px;
            box-shadow: 0 4px 16px rgba(0, 0, 0, .04);
        }

        .cb h3 {
            margin: 0 0 12px;
            font-size: .9rem;
            color: #3E4559;
            display: flex;
            align-items: center;
            gap: 7px;
        }

        .cb h3 i {
            color: #00A59B;
            font-size: .82rem;
        }

        .tc {
            background: white;
            border-radius: 14px;
            padding: 20px;
            box-shadow: 0 4px 16px rgba(0, 0, 0, .04);
            margin-bottom: 20px;
        }

        .tc h3 {
            margin: 0 0 14px;
            font-size: .92rem;
            color: #3E4559;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .badge {
            background: #e7f7f6;
            color: #00A59B;
            padding: 3px 10px;
            border-radius: 20px;
            font-size: .7rem;
        }

        .rt {
            width: 100%;
            border-collapse: collapse;
        }

        .rt th {
            text-align: right;
            padding: 9px 8px;
            font-size: .72rem;
            color: #8c97a8;
            border-bottom: 2px solid #f0f0f0;
            font-weight: 600;
            background: #fafbfc;
        }

        .rt td {
            padding: 9px 8px;
            font-size: .82rem;
            border-bottom: 1px solid #f5f5f5;
        }

        .rt tr:hover td {
            background: #f9fafb;
        }

        .rt tr:last-child td {
            border: none;
        }

        .pill {
            padding: 2px 8px;
            border-radius: 10px;
            font-size: .7rem;
            font-weight: 500;
        }

        .pill-g {
            background: #ecfdf5;
            color: #059669
        }

        .pill-y {
            background: #fffbeb;
            color: #d97706
        }

        .pill-r {
            background: #fef2f2;
            color: #dc2626
        }

        .pill-b {
            background: #eff6ff;
            color: #2563eb
        }

        .pill-gr {
            background: #f3f4f6;
            color: #6b7280
        }

        .search-box {
            border: 1.5px solid #e6ecf2;
            border-radius: 10px;
            padding: 7px 12px;
            font-family: 'Tajawal', sans-serif;
            font-size: .82rem;
            width: 240px;
            outline: none;
        }

        .search-box:focus {
            border-color: #00A59B;
        }

        .pgr {
            display: flex;
            gap: 5px;
            align-items: center;
            justify-content: center;
            margin-top: 14px;
        }

        .pgr button {
            width: 32px;
            height: 32px;
            border: 1.5px solid #e6ecf2;
            border-radius: 8px;
            background: white;
            color: #3E4559;
            cursor: pointer;
            font-family: 'Tajawal';
            font-size: .8rem;
            transition: all .2s;
        }

        .pgr button:hover {
            border-color: #00A59B;
            color: #00A59B;
        }

        .pgr button.ap {
            background: linear-gradient(135deg, #00A59B, #8CC240);
            color: white;
            border: none;
        }

        .pgr span {
            font-size: .78rem;
            color: #8c97a8;
        }

        .dot {
            width: 7px;
            height: 7px;
            border-radius: 50%;
            display: inline-block;
            margin-inline-end: 5px;
        }

        .dot-g {
            background: #8CC240;
        }

        .dot-r {
            background: #ef4444;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px)
            }

            to {
                opacity: 1;
                transform: translateY(0)
            }
        }

        .fi {
            animation: fadeIn .4s ease forwards;
            opacity: 0;
        }

        .fi:nth-child(1) {
            animation-delay: .02s
        }

        .fi:nth-child(2) {
            animation-delay: .04s
        }

        .fi:nth-child(3) {
            animation-delay: .06s
        }

        .fi:nth-child(4) {
            animation-delay: .08s
        }

        .fi:nth-child(5) {
            animation-delay: .1s
        }

        .fi:nth-child(6) {
            animation-delay: .12s
        }

        @media(max-width:1100px) {
            .g3 {
                grid-template-columns: 1fr
            }
        }

        @media(max-width:900px) {

            .g2,
            .g22 {
                grid-template-columns: 1fr
            }

            .rpt-hero {
                flex-direction: column;
                text-align: center;
                gap: 14px
            }

            .hero-stats {
                justify-content: center
            }

            .filter-bar {
                flex-direction: column
            }

            .search-box {
                width: 100%
            }
        }
    </style>
</head>

<body>
    <nav class="sidebar">
        <div class="sidebar-header"><img src="assets/logo.png" alt="TRAOF Logo" style="max-height:56px;"></div>
        <ul class="nav-links">
            <li><a href="index.html"><i class="fas fa-home"></i> Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</a></li>
            <li><a href="cards.html"><i class="fas fa-credit-card"></i> Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª</a></li>
            <li><a href="wallets.html"><i class="fas fa-wallet"></i> Ø§Ù„Ù…Ø­Ø§ÙØ¸</a></li>
            <li><a href="merchants.html"><i class="fas fa-store"></i> Ø§Ù„Ù…ØªØ§Ø¬Ø±</a></li>
            <li><a href="orders.html"><i class="fas fa-file-invoice-dollar"></i> Ø£ÙˆØ§Ù…Ø± Ø§Ù„ØªÙˆØ±ÙŠØ¯</a></li>
            <li><a href="pos.html"><i class="fas fa-cash-register"></i> Ù†Ù‚Ø·Ø© Ø§Ù„Ø¨ÙŠØ¹</a></li>
            <li><a href="reports.html" class="active"><i class="fas fa-chart-bar"></i> Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±</a></li>
            <li><a href="users.html"><i class="fas fa-users-cog"></i> Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</a></li>
            <li><a href="settings.html"><i class="fas fa-cog"></i> Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</a></li>
            <li><a href="monitor.html"><i class="fas fa-stethoscope"></i> ÙØ­Øµ Ø§Ù„Ù†Ø¸Ø§Ù…</a></li>
            <li><a href="support.html"><i class="fas fa-headset"></i> Ø§Ù„Ø¯Ø¹Ù… Ø§Ù„ÙÙ†ÙŠ</a></li>
        </ul>
    </nav>

    <main class="main-content">
        <header>
            <h1><i class="fas fa-chart-bar"></i> Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± ÙˆØ§Ù„ØªØ­Ù„ÙŠÙ„Ø§Øª</h1>
            <div class="user-profile"><span>Ù…Ø±Ø­Ø¨Ø§Ù‹</span>
                <div class="avatar">Ù…</div>
            </div>
        </header>

        <!-- Hero -->
        <div class="rpt-hero fi">
            <div>
                <h2><i class="fas fa-chart-line"></i> Ù…Ø±ÙƒØ² Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ø´Ø§Ù…Ù„</h2>
                <p>ØªØ­Ù„ÙŠÙ„ Ù…ØªÙ‚Ø¯Ù… Ù„ÙƒØ§ÙØ© Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª ÙˆØ§Ù„Ù…Ø§Ù„ÙŠØ© ÙˆØ§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª</p>
            </div>
            <div class="hero-stats">
                <div class="h-stat"><span class="h-val" id="hTx">0</span><span class="h-lbl">Ø¹Ù…Ù„ÙŠØ©</span></div>
                <div class="h-stat"><span class="h-val" id="hTotal">0</span><span class="h-lbl">Ø±.Ø³ Ø¥Ø¬Ù…Ø§Ù„ÙŠ</span></div>
                <div class="h-stat"><span class="h-val" id="hAvg">0</span><span class="h-lbl">Ù…ØªÙˆØ³Ø·</span></div>
                <div class="h-stat"><span class="h-val" id="hDays">0</span><span class="h-lbl">ÙŠÙˆÙ… Ù†Ø´Ø·</span></div>
            </div>
        </div>

        <!-- Filters -->
        <div class="filter-bar fi">
            <div class="fg"><label>Ù…Ù† ØªØ§Ø±ÙŠØ®</label><input type="date" id="fromDate"></div>
            <div class="fg"><label>Ø¥Ù„Ù‰ ØªØ§Ø±ÙŠØ®</label><input type="date" id="toDate"></div>
            <div class="fg"><label>Ø§Ù„Ù…ØªØ¬Ø±</label><select id="fMerch">
                    <option value="">Ø§Ù„ÙƒÙ„</option>
                </select></div>
            <div class="fg"><label>Ø§Ù„Ù…Ø­ÙØ¸Ø©</label><select id="fWallet">
                    <option value="">Ø§Ù„ÙƒÙ„</option>
                </select></div>
            <div class="fg"><label>Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©</label><select id="fCard">
                    <option value="">Ø§Ù„ÙƒÙ„</option>
                </select></div>
            <button class="btn-f btn-main" onclick="applyFilters()"><i class="fas fa-filter"></i> ØªØ·Ø¨ÙŠÙ‚</button>
            <button class="btn-f btn-out" onclick="resetFilters()"><i class="fas fa-undo"></i> Ø¥Ø¹Ø§Ø¯Ø©</button>
            <button class="btn-f btn-out" onclick="exportCSV()"><i class="fas fa-file-excel"></i> Excel</button>
            <button class="btn-f btn-out" onclick="exportPDF()"><i class="fas fa-file-pdf"></i> PDF</button>
        </div>

        <!-- Summary Cards = 6 -->
        <div class="sum-row">
            <div class="sc b1 fi">
                <div class="si c1"><i class="fas fa-receipt"></i></div>
                <div class="si-info">
                    <h4>Ø¹Ø¯Ø¯ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª</h4>
                    <div class="sv" id="sCount">0</div>
                </div>
            </div>
            <div class="sc b2 fi">
                <div class="si c2"><i class="fas fa-coins"></i></div>
                <div class="si-info">
                    <h4>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¨Ø§Ù„Øº</h4>
                    <div class="sv" id="sTotal">0</div>
                </div>
            </div>
            <div class="sc b3 fi">
                <div class="si c3"><i class="fas fa-calculator"></i></div>
                <div class="si-info">
                    <h4>Ù…ØªÙˆØ³Ø· Ø§Ù„Ø¹Ù…Ù„ÙŠØ©</h4>
                    <div class="sv" id="sAvg">0</div>
                </div>
            </div>
            <div class="sc b4 fi">
                <div class="si c4"><i class="fas fa-arrow-up"></i></div>
                <div class="si-info">
                    <h4>Ø£Ø¹Ù„Ù‰ Ø¹Ù…Ù„ÙŠØ©</h4>
                    <div class="sv" id="sMax">0</div>
                </div>
            </div>
            <div class="sc b5 fi">
                <div class="si c5"><i class="fas fa-arrow-down"></i></div>
                <div class="si-info">
                    <h4>Ø£Ù‚Ù„ Ø¹Ù…Ù„ÙŠØ©</h4>
                    <div class="sv" id="sMin">0</div>
                </div>
            </div>
            <div class="sc b6 fi">
                <div class="si c6"><i class="fas fa-calendar-day"></i></div>
                <div class="si-info">
                    <h4>Ø£Ø¹Ù„Ù‰ ÙŠÙˆÙ… Ù…Ø¨ÙŠØ¹Ø§Øª</h4>
                    <div class="sv" id="sTopDay">-</div>
                </div>
            </div>
        </div>

        <!-- Row 1: Daily Sales + Merchant Pie -->
        <div class="g2">
            <div class="cb fi">
                <h3><i class="fas fa-chart-area"></i> Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª Ø§Ù„ÙŠÙˆÙ…ÙŠØ© (Ø¢Ø®Ø± 90 ÙŠÙˆÙ…)</h3>
                <div style="height:270px;position:relative"><canvas id="cDaily"></canvas></div>
            </div>
            <div class="cb fi">
                <h3><i class="fas fa-chart-pie"></i> ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ù…Ø¨Ø§Ù„Øº Ø­Ø³Ø¨ Ø§Ù„Ù…ØªØ¬Ø±</h3>
                <div style="height:270px;position:relative"><canvas id="cMerchPie"></canvas></div>
            </div>
        </div>

        <!-- Row 2: Weekly Comparison + Category Breakdown + Cards Spending -->
        <div class="g3">
            <div class="cb fi">
                <h3><i class="fas fa-calendar-week"></i> Ù…Ù‚Ø§Ø±Ù†Ø© Ø£Ø³Ø¨ÙˆØ¹ÙŠØ©</h3>
                <div style="height:240px;position:relative"><canvas id="cWeekly"></canvas></div>
            </div>
            <div class="cb fi">
                <h3><i class="fas fa-tags"></i> Ø§Ù„Ø¥Ù†ÙØ§Ù‚ Ø­Ø³Ø¨ Ø§Ù„ÙØ¦Ø©</h3>
                <div style="height:240px;position:relative"><canvas id="cCategory"></canvas></div>
            </div>
            <div class="cb fi">
                <h3><i class="fas fa-chart-bar"></i> Ø£Ø¹Ù„Ù‰ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª ØµØ±ÙØ§Ù‹</h3>
                <div style="height:240px;position:relative"><canvas id="cTopCards"></canvas></div>
            </div>
        </div>

        <!-- Row 3: Merchant Count Bar + Wallet Spend Polar + Orders Status -->
        <div class="g3">
            <div class="cb fi">
                <h3><i class="fas fa-store"></i> Ø¹Ø¯Ø¯ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ù„ÙƒÙ„ Ù…ØªØ¬Ø±</h3>
                <div style="height:240px;position:relative"><canvas id="cMerchCount"></canvas></div>
            </div>
            <div class="cb fi">
                <h3><i class="fas fa-wallet"></i> Ø§Ù„Ø¥Ù†ÙØ§Ù‚ Ø­Ø³Ø¨ Ø§Ù„Ù…Ø­ÙØ¸Ø©</h3>
                <div style="height:240px;position:relative"><canvas id="cWalletSpend"></canvas></div>
            </div>
            <div class="cb fi">
                <h3><i class="fas fa-truck"></i> Ø­Ø§Ù„Ø© Ø£ÙˆØ§Ù…Ø± Ø§Ù„ØªÙˆØ±ÙŠØ¯</h3>
                <div style="height:240px;position:relative"><canvas id="cOrdersStatus"></canvas></div>
            </div>
        </div>

        <!-- Row 4: Top Beneficiaries Table + Top Merchants Table -->
        <div class="g22">
            <div class="tc fi">
                <h3><span><i class="fas fa-users" style="color:#00A59B;margin-inline-end:6px"></i> Ø£Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø³ØªÙÙŠØ¯ÙŠÙ†
                        ØµØ±ÙØ§Ù‹</span><span class="badge" id="benBadge">0</span></h3>
                <table class="rt">
                    <thead>
                        <tr>
                            <th>#</th>
                            <th>Ø§Ù„Ù…Ø³ØªÙÙŠØ¯</th>
                            <th>Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©</th>
                            <th>Ø¹Ø¯Ø¯ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª</th>
                            <th>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ØµØ±Ù</th>
                        </tr>
                    </thead>
                    <tbody id="topBenBody"></tbody>
                </table>
            </div>
            <div class="tc fi">
                <h3><span><i class="fas fa-store" style="color:#8CC240;margin-inline-end:6px"></i> Ø£Ø¹Ù„Ù‰ Ø§Ù„Ù…ØªØ§Ø¬Ø±
                        Ø¥ÙŠØ±Ø§Ø¯Ø§Ù‹</span><span class="badge" id="topMerBadge">0</span></h3>
                <table class="rt">
                    <thead>
                        <tr>
                            <th>#</th>
                            <th>Ø§Ù„Ù…ØªØ¬Ø±</th>
                            <th>Ø§Ù„ÙØ¦Ø©</th>
                            <th>Ø¹Ø¯Ø¯ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª</th>
                            <th>Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯</th>
                        </tr>
                    </thead>
                    <tbody id="topMerBody"></tbody>
                </table>
            </div>
        </div>

        <!-- Row 5: Orders Table + Wallet Balance Table -->
        <div class="g22">
            <div class="tc fi">
                <h3><span><i class="fas fa-file-invoice-dollar" style="color:#f59e0b;margin-inline-end:6px"></i> Ø£ÙˆØ§Ù…Ø±
                        Ø§Ù„ØªÙˆØ±ÙŠØ¯</span><span class="badge" id="ordBadge">0</span></h3>
                <table class="rt">
                    <thead>
                        <tr>
                            <th>Ø±Ù‚Ù…</th>
                            <th>Ø§Ù„ÙˆØµÙ</th>
                            <th>Ø§Ù„Ø´Ø±ÙŠÙƒ</th>
                            <th>Ø§Ù„ØªÙƒÙ„ÙØ©</th>
                            <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
                        </tr>
                    </thead>
                    <tbody id="ordBody"></tbody>
                </table>
            </div>
            <div class="tc fi">
                <h3><span><i class="fas fa-wallet" style="color:#8b5cf6;margin-inline-end:6px"></i> Ø£Ø±ØµØ¯Ø©
                        Ø§Ù„Ù…Ø­Ø§ÙØ¸</span><span class="badge" id="walBadge">0</span></h3>
                <table class="rt">
                    <thead>
                        <tr>
                            <th>Ø§Ù„Ù…Ø­ÙØ¸Ø©</th>
                            <th>Ø§Ù„Ø±ØµÙŠØ¯</th>
                            <th>Ø§Ù„Ù…ØµØ±ÙˆÙ</th>
                            <th>Ø¹Ø¯Ø¯ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª</th>
                            <th>Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ %</th>
                        </tr>
                    </thead>
                    <tbody id="walBody"></tbody>
                </table>
            </div>
        </div>

        <!-- Full Transaction Log -->
        <div class="tc fi">
            <h3>
                <span><i class="fas fa-list" style="color:#00A59B;margin-inline-end:6px"></i> Ø³Ø¬Ù„ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª
                    Ø§Ù„ØªÙØµÙŠÙ„ÙŠ</span>
                <span style="display:flex;align-items:center;gap:8px">
                    <span class="badge" id="txBadge">0</span>
                    <input class="search-box" id="txSearch" type="text" placeholder="ğŸ” Ø§Ø¨Ø­Ø« Ø¨Ø§Ù„Ù…ØªØ¬Ø± Ø£Ùˆ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©...">
                </span>
            </h3>
            <table class="rt">
                <thead>
                    <tr>
                        <th>#</th>
                        <th>Ø§Ù„Ù…ØªØ¬Ø±</th>
                        <th>Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©</th>
                        <th>Ø§Ù„Ù…Ø³ØªÙÙŠØ¯</th>
                        <th>Ø§Ù„Ù…Ø­ÙØ¸Ø©</th>
                        <th>Ø§Ù„Ù…Ø¨Ù„Øº</th>
                        <th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
                    </tr>
                </thead>
                <tbody id="txBody"></tbody>
            </table>
            <div class="pgr" id="txPager"></div>
        </div>

        <footer class="main-footer">
            <p>ØµÙ†Ø¹ ÙÙŠ ØªØ±Ø§Ø¤Ù</p><img src="assets/logo.png" alt="TRAOF Logo">
        </footer>
    </main>

    <script src="script.js?v=7"></script>
    <script>
        const B = { teal: '#00A59B', green: '#8CC240', ink: '#3E4559', orange: '#f59e0b', purple: '#8b5cf6', red: '#ef4444', cyan: '#06b6d4', pink: '#ec4899' };
        const CL = [B.teal, B.green, B.ink, B.orange, B.purple, B.red, B.cyan, B.pink, '#14b8a6', '#a855f7', '#10b981', '#f43f5e', '#0ea5e9', '#84cc16'];
        let allTx = [], filtered = [], pg = 1; const PP = 15;
        let charts = {};

        function init() {
            allTx = Storage.get('transactions') || [];
            filtered = [...allTx];
            populateDropdowns();
            updateAll();
        }

        function populateDropdowns() {
            const ms = Storage.get('merchants') || [], ws = Storage.get('wallets') || [], cs = Storage.get('cards') || [];
            const mS = document.getElementById('fMerch'), wS = document.getElementById('fWallet'), cS = document.getElementById('fCard');
            ms.forEach(m => { const o = document.createElement('option'); o.value = m.name; o.textContent = m.name; mS.appendChild(o) });
            ws.forEach(w => { const o = document.createElement('option'); o.value = w.name; o.textContent = w.name; wS.appendChild(o) });
            cs.forEach(c => { const o = document.createElement('option'); o.value = c.number; o.textContent = c.number + ' â€” ' + (c.beneficiary || '').split(' ').slice(0, 2).join(' '); cS.appendChild(o) });
        }

        function applyFilters() {
            const m = document.getElementById('fMerch').value, w = document.getElementById('fWallet').value, c = document.getElementById('fCard').value;
            const cards = Storage.get('cards') || [];
            filtered = allTx.filter(t => {
                if (m && t.merchant !== m) return false;
                if (c && t.card !== c) return false;
                if (w) { const wCards = cards.filter(x => x.wallet === w).map(x => x.number); if (!wCards.includes(t.card)) return false; }
                return true;
            });
            pg = 1; updateAll();
        }

        function resetFilters() {
            document.getElementById('fMerch').value = ''; document.getElementById('fWallet').value = '';
            document.getElementById('fCard').value = ''; document.getElementById('fromDate').value = '';
            document.getElementById('toDate').value = ''; document.getElementById('txSearch').value = '';
            filtered = [...allTx]; pg = 1; updateAll();
        }

        function updateAll() { updateHero(); updateSummary(); buildDaily(); buildMerchPie(); buildWeekly(); buildCategory(); buildTopCards(); buildMerchCount(); buildWalletSpend(); buildOrdersStatus(); loadTopBen(); loadTopMer(); loadOrders(); loadWallets(); renderTable(); }

        function updateHero() {
            const t = filtered.reduce((s, x) => s + Number(x.amount || 0), 0), a = filtered.length ? Math.round(t / filtered.length) : 0;
            const days = new Set(filtered.map(x => x.date)).size;
            document.getElementById('hTx').textContent = filtered.length.toLocaleString('ar-SA');
            document.getElementById('hTotal').textContent = t.toLocaleString('ar-SA');
            document.getElementById('hAvg').textContent = a.toLocaleString('ar-SA');
            document.getElementById('hDays').textContent = days;
        }

        function updateSummary() {
            const t = filtered.reduce((s, x) => s + Number(x.amount || 0), 0);
            const a = filtered.length ? Math.round(t / filtered.length) : 0;
            const mx = filtered.length ? Math.max(...filtered.map(x => Number(x.amount || 0))) : 0;
            const mn = filtered.length ? Math.min(...filtered.map(x => Number(x.amount || 0))) : 0;
            document.getElementById('sCount').textContent = filtered.length.toLocaleString('ar-SA');
            document.getElementById('sTotal').textContent = t.toLocaleString('ar-SA') + ' Ø±.Ø³';
            document.getElementById('sAvg').textContent = a.toLocaleString('ar-SA') + ' Ø±.Ø³';
            document.getElementById('sMax').textContent = mx.toLocaleString('ar-SA') + ' Ø±.Ø³';
            document.getElementById('sMin').textContent = mn.toLocaleString('ar-SA') + ' Ø±.Ø³';
            // Top day
            const dm = {}; filtered.forEach(x => { dm[x.date] = (dm[x.date] || 0) + Number(x.amount || 0) });
            const topD = Object.entries(dm).sort((a, b) => b[1] - a[1])[0];
            document.getElementById('sTopDay').textContent = topD ? topD[1].toLocaleString('ar-SA') + ' Ø±.Ø³' : 'â€”';
        }

        function dc(k) { if (charts[k]) charts[k].destroy(); }

        // Chart 1: Daily (90 days line)
        function buildDaily() {
            dc('daily'); const el = document.getElementById('cDaily'); if (!el) return;
            const dm = {}; filtered.forEach(t => { dm[t.date] = (dm[t.date] || 0) + Number(t.amount || 0) });
            const now = new Date(), labels = [], data = [];
            for (let i = 89; i >= 0; i--) {
                const d = new Date(now); d.setDate(now.getDate() - i);
                const k = d.toLocaleDateString('ar-SA'); labels.push(d.toLocaleDateString('ar-SA', { day: 'numeric', month: 'numeric' })); data.push(dm[k] || 0);
            }
            charts['daily'] = new Chart(el.getContext('2d'), {
                type: 'line', data: { labels, datasets: [{ label: 'Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª', data, borderColor: B.teal, backgroundColor: 'rgba(0,165,155,.1)', fill: true, tension: .4, borderWidth: 2, pointRadius: 1, pointHoverRadius: 5 }] },
                options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false } }, scales: { y: { beginAtZero: true, grid: { color: '#f0f0f0' }, ticks: { font: { size: 9 } } }, x: { grid: { display: false }, ticks: { maxTicksLimit: 12, font: { size: 8 } } } } }
            });
        }

        // Chart 2: Merchant Pie
        function buildMerchPie() {
            dc('mpie'); const el = document.getElementById('cMerchPie'); if (!el) return;
            const mm = {}; filtered.forEach(t => { mm[t.merchant] = (mm[t.merchant] || 0) + Number(t.amount || 0) });
            const s = Object.entries(mm).sort((a, b) => b[1] - a[1]);
            charts['mpie'] = new Chart(el.getContext('2d'), {
                type: 'doughnut', data: { labels: s.map(x => x[0]), datasets: [{ data: s.map(x => x[1]), backgroundColor: CL.slice(0, s.length), borderWidth: 0, hoverOffset: 6 }] },
                options: { responsive: true, maintainAspectRatio: false, cutout: '58%', plugins: { legend: { position: 'bottom', labels: { boxWidth: 9, padding: 7, font: { family: 'Tajawal', size: 9 } } } } }
            });
        }

        // Chart 3: Weekly comparison (bar with last 12 weeks)
        function buildWeekly() {
            dc('weekly'); const el = document.getElementById('cWeekly'); if (!el) return;
            const now = new Date(), weeks = [], labels = [];
            for (let w = 11; w >= 0; w--) {
                const wStart = new Date(now); wStart.setDate(now.getDate() - (w * 7 + 6));
                const wEnd = new Date(now); wEnd.setDate(now.getDate() - w * 7);
                let total = 0;
                filtered.forEach(t => {
                    // Compare by matching dates
                    const dm = {}; dm[t.date] = true;
                    // Simple: count all tx in a 7 day window
                    for (let d = 0; d < 7; d++) {
                        const dd = new Date(wStart); dd.setDate(wStart.getDate() + d);
                        if (t.date === dd.toLocaleDateString('ar-SA')) total += Number(t.amount || 0);
                    }
                });
                weeks.push(total);
                labels.push('Ø£Ø³Ø¨ÙˆØ¹ ' + (12 - w));
            }
            charts['weekly'] = new Chart(el.getContext('2d'), {
                type: 'bar', data: { labels, datasets: [{ label: 'Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ÙŠØ©', data: weeks, backgroundColor: CL.map(c => c + 'bb'), borderRadius: 5, borderSkipped: false }] },
                options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false } }, scales: { y: { beginAtZero: true, grid: { color: '#f0f0f0' } }, x: { grid: { display: false }, ticks: { font: { family: 'Tajawal', size: 9 } } } } }
            });
        }

        // Chart 4: Category breakdown
        function buildCategory() {
            dc('cat'); const el = document.getElementById('cCategory'); if (!el) return;
            const merchants = Storage.get('merchants') || [];
            const catMap = {};
            filtered.forEach(t => {
                const m = merchants.find(x => x.name === t.merchant);
                const cat = m ? m.category : 'Ø£Ø®Ø±Ù‰';
                catMap[cat] = (catMap[cat] || 0) + Number(t.amount || 0);
            });
            const s = Object.entries(catMap).sort((a, b) => b[1] - a[1]);
            charts['cat'] = new Chart(el.getContext('2d'), {
                type: 'polarArea', data: { labels: s.map(x => x[0]), datasets: [{ data: s.map(x => x[1]), backgroundColor: CL.slice(0, s.length).map(c => c + 'bb'), borderWidth: 0 }] },
                options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { position: 'bottom', labels: { boxWidth: 9, padding: 7, font: { family: 'Tajawal', size: 10 } } } }, scales: { r: { display: false } } }
            });
        }

        // Chart 5: Top Cards spending (horizontal bar)
        function buildTopCards() {
            dc('tcards'); const el = document.getElementById('cTopCards'); if (!el) return;
            const cm = {}; filtered.forEach(t => { cm[t.card] = (cm[t.card] || 0) + Number(t.amount || 0) });
            const sorted = Object.entries(cm).sort((a, b) => b[1] - a[1]).slice(0, 7);
            const cards = Storage.get('cards') || [];
            const labels = sorted.map(s => { const c = cards.find(x => x.number === s[0]); return c ? (c.beneficiary || '').split(' ').slice(0, 2).join(' ') : s[0]; });
            charts['tcards'] = new Chart(el.getContext('2d'), {
                type: 'bar', data: { labels, datasets: [{ label: 'Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ØµØ±Ù', data: sorted.map(s => s[1]), backgroundColor: B.green + 'cc', borderRadius: 5, borderSkipped: false }] },
                options: { indexAxis: 'y', responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false } }, scales: { x: { beginAtZero: true, grid: { color: '#f0f0f0' } }, y: { grid: { display: false }, ticks: { font: { family: 'Tajawal', size: 10 } } } } }
            });
        }

        // Chart 6: Merchant count (bar)
        function buildMerchCount() {
            dc('mcount'); const el = document.getElementById('cMerchCount'); if (!el) return;
            const mm = {}; filtered.forEach(t => { mm[t.merchant] = (mm[t.merchant] || 0) + 1 });
            const s = Object.entries(mm).sort((a, b) => b[1] - a[1]).slice(0, 8);
            charts['mcount'] = new Chart(el.getContext('2d'), {
                type: 'bar', data: { labels: s.map(x => x[0]), datasets: [{ label: 'Ø¹Ø¯Ø¯ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª', data: s.map(x => x[1]), backgroundColor: CL.slice(0, s.length), borderRadius: 5, borderSkipped: false }] },
                options: { indexAxis: 'y', responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false } }, scales: { x: { beginAtZero: true, grid: { color: '#f0f0f0' } }, y: { grid: { display: false }, ticks: { font: { family: 'Tajawal', size: 10 } } } } }
            });
        }

        // Chart 7: Wallet spend (doughnut)
        function buildWalletSpend() {
            dc('wspend'); const el = document.getElementById('cWalletSpend'); if (!el) return;
            const cards = Storage.get('cards') || [], wallets = Storage.get('wallets') || [];
            const wm = {}; wallets.forEach(w => { wm[w.name] = 0 });
            filtered.forEach(t => { const c = cards.find(x => x.number === t.card); if (c && wm.hasOwnProperty(c.wallet)) wm[c.wallet] += Number(t.amount || 0) });
            const s = Object.entries(wm).filter(e => e[1] > 0).sort((a, b) => b[1] - a[1]);
            charts['wspend'] = new Chart(el.getContext('2d'), {
                type: 'doughnut', data: { labels: s.map(x => x[0]), datasets: [{ data: s.map(x => x[1]), backgroundColor: CL.slice(0, s.length), borderWidth: 0, hoverOffset: 6 }] },
                options: { responsive: true, maintainAspectRatio: false, cutout: '55%', plugins: { legend: { position: 'bottom', labels: { boxWidth: 9, padding: 7, font: { family: 'Tajawal', size: 10 } } } } }
            });
        }

        // Chart 8: Orders status (pie)
        function buildOrdersStatus() {
            dc('ostatus'); const el = document.getElementById('cOrdersStatus'); if (!el) return;
            const orders = Storage.get('supply_orders') || [];
            const sm = { 'Completed': 0, 'Pending': 0, 'Accepted': 0, 'Rejected': 0, 'Withdrawn': 0 };
            orders.forEach(o => { if (sm.hasOwnProperty(o.status)) sm[o.status]++ });
            const labels = ['Ù…ÙƒØªÙ…Ù„', 'Ù…Ø¹Ù„Ù‚', 'Ù…Ù‚Ø¨ÙˆÙ„', 'Ù…Ø±ÙÙˆØ¶', 'Ù…Ø³Ø­ÙˆØ¨'], data = Object.values(sm);
            charts['ostatus'] = new Chart(el.getContext('2d'), {
                type: 'pie', data: { labels, datasets: [{ data, backgroundColor: [B.green, B.orange, B.teal, B.red, '#9ca3af'], borderWidth: 0, hoverOffset: 6 }] },
                options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { position: 'bottom', labels: { boxWidth: 9, padding: 7, font: { family: 'Tajawal', size: 10 } } } } }
            });
        }

        // Table: Top Beneficiaries
        function loadTopBen() {
            const cards = Storage.get('cards') || [];
            const bm = {}; filtered.forEach(t => {
                const c = cards.find(x => x.number === t.card);
                const name = c ? c.beneficiary : 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ';
                if (!bm[name]) bm[name] = { count: 0, total: 0, card: t.card };
                bm[name].count++; bm[name].total += Number(t.amount || 0);
            });
            const sorted = Object.entries(bm).sort((a, b) => b[1].total - a[1].total).slice(0, 10);
            document.getElementById('benBadge').textContent = sorted.length + ' Ù…Ø³ØªÙÙŠØ¯';
            document.getElementById('topBenBody').innerHTML = sorted.length ? sorted.map((s, i) => `<tr>
            <td style="color:#8c97a8">${i + 1}</td>
            <td style="font-weight:500">${s[0]}</td>
            <td style="font-family:monospace;font-size:.78rem">${s[1].card}</td>
            <td style="font-weight:600;color:${B.purple}">${s[1].count}</td>
            <td style="font-weight:700;color:${B.teal}">${s[1].total.toLocaleString('ar-SA')} Ø±.Ø³</td>
        </tr>`).join('') : '<tr><td colspan="5" style="text-align:center;color:#aaa;padding:20px">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª</td></tr>';
        }

        // Table: Top Merchants
        function loadTopMer() {
            const merchants = Storage.get('merchants') || [];
            const mm = {}; filtered.forEach(t => { if (!mm[t.merchant]) mm[t.merchant] = { count: 0, total: 0 }; mm[t.merchant].count++; mm[t.merchant].total += Number(t.amount || 0) });
            const sorted = Object.entries(mm).sort((a, b) => b[1].total - a[1].total);
            document.getElementById('topMerBadge').textContent = sorted.length + ' Ù…ØªØ¬Ø±';
            document.getElementById('topMerBody').innerHTML = sorted.length ? sorted.map((s, i) => {
                const m = merchants.find(x => x.name === s[0]);
                return `<tr>
                <td style="color:#8c97a8">${i + 1}</td>
                <td style="font-weight:500">${s[0]}</td>
                <td style="font-size:.78rem;color:#8c97a8">${m ? m.category : 'â€”'}</td>
                <td style="font-weight:600;color:${B.purple}">${s[1].count}</td>
                <td style="font-weight:700;color:${B.green}">${s[1].total.toLocaleString('ar-SA')} Ø±.Ø³</td>
            </tr>`}).join('') : '<tr><td colspan="5" style="text-align:center;color:#aaa;padding:20px">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª</td></tr>';
        }

        // Table: Supply Orders
        function loadOrders() {
            const orders = Storage.get('supply_orders') || [];
            const pills = { 'Completed': '<span class="pill pill-g">Ù…ÙƒØªÙ…Ù„</span>', 'Pending': '<span class="pill pill-y">Ù…Ø¹Ù„Ù‚</span>', 'Accepted': '<span class="pill pill-b">Ù…Ù‚Ø¨ÙˆÙ„</span>', 'Rejected': '<span class="pill pill-r">Ù…Ø±ÙÙˆØ¶</span>', 'Withdrawn': '<span class="pill pill-gr">Ù…Ø³Ø­ÙˆØ¨</span>' };
            document.getElementById('ordBadge').textContent = orders.length + ' Ø£Ù…Ø±';
            document.getElementById('ordBody').innerHTML = orders.length ? orders.map(o => `<tr>
            <td style="font-family:monospace;font-weight:600">#${o.id}</td>
            <td style="font-size:.78rem">${(o.item || '').substring(0, 30)}${(o.item || '').length > 30 ? '...' : ''}</td>
            <td>${o.partner}</td>
            <td style="font-weight:600">${Number(o.cost).toLocaleString('ar-SA')}</td>
            <td>${pills[o.status] || o.status}</td>
        </tr>`).join('') : '<tr><td colspan="5" style="text-align:center;color:#aaa;padding:20px">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£ÙˆØ§Ù…Ø±</td></tr>';
        }

        // Table: Wallet Balances with spending analysis
        function loadWallets() {
            const wallets = Storage.get('wallets') || [], cards_all = Storage.get('cards') || [];
            document.getElementById('walBadge').textContent = wallets.length + ' Ù…Ø­ÙØ¸Ø©';
            document.getElementById('walBody').innerHTML = wallets.length ? wallets.map(w => {
                const wCards = cards_all.filter(c => c.wallet === w.name);
                let spent = 0; filtered.forEach(t => { if (wCards.find(c => c.number === t.card)) spent += Number(t.amount || 0) });
                const remaining = w.funds > 0 ? Math.round(((w.funds - spent) / w.funds) * 100) : 0;
                const color = remaining > 50 ? B.green : remaining > 20 ? B.orange : B.red;
                return `<tr>
                <td style="font-weight:500">${w.name}</td>
                <td style="font-weight:600">${Number(w.funds).toLocaleString('ar-SA')}</td>
                <td style="font-weight:600;color:${B.red}">${spent.toLocaleString('ar-SA')}</td>
                <td style="color:${B.purple}">${wCards.length}</td>
                <td><span style="color:${color};font-weight:700">${remaining}%</span></td>
            </tr>`}).join('') : '<tr><td colspan="5" style="text-align:center;color:#aaa;padding:20px">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø­Ø§ÙØ¸</td></tr>';
        }

        // Full Transaction Table
        function renderTable() {
            const search = (document.getElementById('txSearch').value || '').trim().toLowerCase();
            let data = filtered;
            if (search) data = data.filter(t => t.merchant.toLowerCase().includes(search) || t.card.includes(search));
            const tp = Math.ceil(data.length / PP) || 1; if (pg > tp) pg = tp;
            const start = (pg - 1) * PP, page = data.slice(start, start + PP);
            const cards = Storage.get('cards') || [];
            document.getElementById('txBadge').textContent = data.length + ' Ø¹Ù…Ù„ÙŠØ©';
            const tbody = document.getElementById('txBody');
            if (!page.length) { tbody.innerHTML = '<tr><td colspan="7" style="text-align:center;color:#aaa;padding:30px">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¹Ù…Ù„ÙŠØ§Øª</td></tr>'; }
            else {
                tbody.innerHTML = page.map((t, i) => {
                    const c = cards.find(x => x.number === t.card);
                    const ben = c ? (c.beneficiary || '').split(' ').slice(0, 2).join(' ') : 'â€”';
                    const wal = c ? c.wallet : 'â€”';
                    return `<tr>
                    <td style="color:#8c97a8;font-size:.72rem">${start + i + 1}</td>
                    <td style="font-weight:500">${t.merchant}</td>
                    <td style="font-family:monospace;font-size:.78rem">${t.card}</td>
                    <td>${ben}</td>
                    <td style="font-size:.78rem;color:#8c97a8">${wal}</td>
                    <td style="font-weight:700;color:${B.teal}">${Number(t.amount).toLocaleString('ar-SA')}</td>
                    <td style="color:#8c97a8;font-size:.75rem">${t.date}</td>
                </tr>`}).join('');
            }
            // Pagination
            const pgr = document.getElementById('txPager');
            if (tp <= 1) { pgr.innerHTML = ''; return; }
            let h = `<button onclick="gp(1)" ${pg === 1 ? 'disabled' : ''}><i class="fas fa-angle-double-right"></i></button>`;
            h += `<button onclick="gp(${pg - 1})" ${pg === 1 ? 'disabled' : ''}><i class="fas fa-angle-right"></i></button>`;
            let s = Math.max(1, pg - 2), e = Math.min(tp, s + 4); if (e - s < 4) s = Math.max(1, e - 4);
            for (let p = s; p <= e; p++) h += `<button class="${p === pg ? 'ap' : ''}" onclick="gp(${p})">${p}</button>`;
            h += `<button onclick="gp(${pg + 1})" ${pg === tp ? 'disabled' : ''}><i class="fas fa-angle-left"></i></button>`;
            h += `<button onclick="gp(${tp})" ${pg === tp ? 'disabled' : ''}><i class="fas fa-angle-double-left"></i></button>`;
            h += `<span>ØµÙØ­Ø© ${pg} Ù…Ù† ${tp}</span>`;
            pgr.innerHTML = h;
        }
        function gp(p) { const tp = Math.ceil(filtered.length / PP) || 1; if (p < 1 || p > tp) return; pg = p; renderTable(); }
        document.getElementById('txSearch').addEventListener('input', () => { pg = 1; renderTable() });

        function exportCSV() {
            if (!filtered.length) { alert('Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª'); return; }
            const cards = Storage.get('cards') || [];
            let csv = '\uFEFF#,Ø§Ù„Ù…ØªØ¬Ø±,Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©,Ø§Ù„Ù…Ø³ØªÙÙŠØ¯,Ø§Ù„Ù…Ø­ÙØ¸Ø©,Ø§Ù„Ù…Ø¨Ù„Øº,Ø§Ù„ØªØ§Ø±ÙŠØ®\n';
            filtered.forEach((t, i) => {
                const c = cards.find(x => x.number === t.card);
                csv += `${i + 1},${t.merchant},${t.card},${c ? c.beneficiary : '-'},${c ? c.wallet : '-'},${t.amount},${t.date}\n`
            });
            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a'); link.href = URL.createObjectURL(blob);
            link.download = 'ØªÙ‚Ø±ÙŠØ±_Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª_' + new Date().toLocaleDateString('ar-SA') + '.csv'; link.click();
        }
        function exportPDF() { window.print() }

        const _o = window.onload; window.onload = function () { if (_o) _o(); setTimeout(init, 100) };
    </script>
</body>

</html>